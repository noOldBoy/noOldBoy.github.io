<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>mysql事务 | buer</title><meta name="keywords" content="mysql"><meta name="author" content="buer"><meta name="copyright" content="buer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="mysql事务"><meta name="application-name" content="mysql事务"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="mysql事务"><meta property="og:url" content="http://example.com/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/index.html"><meta property="og:site_name" content="buer"><meta property="og:description" content="MySQL事务and使用方式总结   一、Mysql 事务的概念  Mysql 事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中， 要删除一个人员，既需要删除人员的基本资料，又需要删除和该人员相关的信息，如信箱， 文章等等。这样，这些数据库操作语句就构成一个事务！ 事务是一种机制、"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/images/background/13.jpeg"><meta property="article:author" content="buer"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/images/background/13.jpeg"><meta name="description" content="MySQL事务and使用方式总结   一、Mysql 事务的概念  Mysql 事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中， 要删除一个人员，既需要删除人员的基本资料，又需要删除和该人员相关的信息，如信箱， 文章等等。这样，这些数据库操作语句就构成一个事务！ 事务是一种机制、"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 性格怪异夜猫子","🏠 善良可救赎自己","🔨 设计开发一条龙","🏃 脚踏实地行动派"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: buer","link":"链接: ","source":"来源: buer","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'buer',
  title: 'mysql事务',
  postAI: '',
  pageFillDescription: '一、Mysql 事务的概念, 二、事务的特性（ACID）, 1.原子性, 概念：, 案例：, 2.一致性, 概念：, 案例, 3.隔离性, 4.持久性, 概念：, 三、事务之间的相互影响, 1.脏读, 概念：, 案例：, 2.不可重复读, 概念：, 案例：, 3.幻读, 概念：, 案列：, 4.丢失更新, 概念：, 案例：, 四、事务的隔离级别, 1.事物隔离级别分类, 2.事务隔离级别作用范围, 3.1设置全局隔离级别, 全局, 1.读未提交, 2.读提交, 3.重复读, 4.串行化, 当前会话, 3.2查看当前隔离级别, 当前会话隔离级别, 五、事务控制语句, 事务开启, 提交事务, 回滚事务, 标记回滚点, 回滚到回滚点, 六、事务操作示例, 1.创建测试数据库, 2.测试创建提交事务, 3.测试回滚事务, 4.测试多点回滚, 七、事务提交方式, 查看当前提交方式, 自动提交, 手动提交事务使用方式总结一事务的概念事务主要用于处理操作量大复杂度高的数据比如说在人员管理系统中要删除一个人员既需要删除人员的基本资料又需要删除和该人员相关的信息如信箱文章等等这样这些数据库操作语句就构成一个事务事务是一种机制一个操作序列包含了一组数据库操作命令并且把所有的命令作为一个整体一起向系统提交或撤销操作请求即这一组数据库命令要么都执行要么都不执行事务是一个不可分割的工作逻辑单元在数据库系统上执行并发操作时事务是最小的控制单元事务适用于多用户同时操作的数据库系统的场景如银行保险公司及证券交易系统等等事务是通过事务的整体性以保证数据的一致性简单来说所谓事务它是一个操作序列这些操作要么都执行要么都不执行它是一个不可分割的工作单位二事务的特性原子性概念每个事务都是单独的不可再分的工作单位要么整个事务都操作成功要么全部失败案例给转帐元钱的时候只执行了扣款语句就提交了此时如果突然断电账号已经发生了扣款账号却没收到加款在生活中就会引起纠纷这种情况就需要事务的原子性来保证事务要么都执行要么就都不执行一致性概念事务在执行前后数据库的数据完整性没有被破坏即事务执行前后数据保持一致即事务执行前数据保持一致事务执行中数据可能不一致事务执行后数据保持一致案例对银行转帐事务不管事务成功还是失败应该保证事务结束后表中和的存款总额跟事务执行前一致隔离性概念事务之前互不影响当不同的事务同时操纵相同的数据时每个事务都有各自的完整数据空间持久性概念在事务完成以后该事务所对数据库所作的更改便持久的保存在数据库之中三事务之间的相互影响脏读概念脏读是指读到了其他事物未提交的数据未提交的事物可能会回滚然后你读到的数据会跟数据库实际数据不一致产生脏读案例比如事务执行过程中修改了数据在未提交前事务读取了而事务却回滚了这样事务就形成了脏读也就是说当前事务读到的数据是别的事务想要修改成为的但是没有修改成功的数据不可重复读概念一个事物内多次查询出来的数据不一致原因查询前后间隔有其他事物提交更改了数据案例事务第一次查询得到一行记录事务提交修改后事务第二次查询得到但列内容发生了变化幻读概念前后多次读取数据不一致一个事物对表中的数据修改涉及所有的行在事物提交前有另一个事物在表中插入数据作前一个事务的用户会发现表中还有没有修改的数据行就好象发生了幻觉一样案列假设事务对某些行的内容作了更改但是还未提交此时事务插入了与事务更改前的记录相同的记录行并且在事务提交之前先提交了而这时在事务中查询会发现好像刚刚的更改对于某些数据未起作用但其实是事务刚插入进来的让用户感觉很魔幻感觉出现了幻觉这就叫幻读丢失更新概念两个事务同时读取同一条记录先修改记录也修改记录不知道修改过提交数据后的修改结果覆盖了的修改结果案例案列事务先完成事务后完成的事务结果会覆盖的事务结果最终值为四事务的隔离级别事物隔离级别分类未提交读读取尚未提交的数据会产生脏读注可以读到事务未提交的变更会产生脏读问题提交读读取已经提交的数据可以解决脏读可重复度重读读取可以解决脏读和不可重复读默认注可重复读无论其他事务是否修改并提交了数据在这个事务中看到的数据值始终不受其他事务影响串行化可以解决脏读不可重复读幻读相当于锁表的表锁注完全串行化的读每次读都需要获得表级共享锁读写相互都会阻塞事务隔离级别作用范围全局级对所有的会话有效会话级只对当前的会话有效设置全局隔离级别全局读未提交读提交重复读串行化当前会话设置当前会话隔离级别替换为查看当前隔离级别当前会话隔离级别五事务控制语句事务开启显式地开启一个事务提交事务提交事务并使已对数据库进行的所有修改变为永久性的回滚事务回滚会结束用户的事务并撤销正在进行的所有未提交的修改标记回滚点使用允许在事务中创建一个回滚点一个事务中可以有多个代表回滚点名称回滚到回滚点把事务回滚到标记点六事务操作示例创建测试数据库测试创建提交事务运行结果因为是在一个事务里查询到的结果就是后的结果测试回滚事务运行结果结果因为是在事务里面查到了的数据回滚会结束事务所以结果查到的是回滚后操作前原本的数据测试多点回滚运行结果结果原数据结果数据加的结果结果数据加的结果结果语句后的结果结果回滚到节点的结果七事务提交方式查看当前提交方式自动提交手动提交注如果没有开启自动提交当前会话连接的的所有操作都会当成一个事务直到你输入当前事务才算结束当前事务结束前新的连接时无法读取到任何当前会话的操作结果如果开起了自动提交会把每个语句当成一个事务然后自动的当然无论开启与否都是独立的事务',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-14 11:22:55',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">buer</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 应用箱</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://165.154.134.66:8000"><i class="anzhiyufont anzhiyu-icon-stopwatch faa-tada" style="font-size: 0.9em;"></i><span> 项目平台</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://165.154.134.66:8123"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 智能家居</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://165.154.134.66:3000"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> AI</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BigDecimal/" style="font-size: 1.05rem;">BigDecimal<sup>1</sup></a><a href="/tags/Cookie/" style="font-size: 1.05rem;">Cookie<sup>1</sup></a><a href="/tags/English/" style="font-size: 1.05rem;">English<sup>1</sup></a><a href="/tags/Mac/" style="font-size: 1.05rem;">Mac<sup>2</sup></a><a href="/tags/Session/" style="font-size: 1.05rem;">Session<sup>1</sup></a><a href="/tags/Transactional/" style="font-size: 1.05rem;">Transactional<sup>1</sup></a><a href="/tags/Typora/" style="font-size: 1.05rem;">Typora<sup>1</sup></a><a href="/tags/aop/" style="font-size: 1.05rem;">aop<sup>1</sup></a><a href="/tags/bug/" style="font-size: 1.05rem;">bug<sup>5</sup></a><a href="/tags/cron/" style="font-size: 1.05rem;">cron<sup>1</sup></a><a href="/tags/css/" style="font-size: 1.05rem;">css<sup>1</sup></a><a href="/tags/excal/" style="font-size: 1.05rem;">excal<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>2</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>11</sup></a><a href="/tags/js/" style="font-size: 1.05rem;">js<sup>1</sup></a><a href="/tags/jsoup/" style="font-size: 1.05rem;">jsoup<sup>1</sup></a><a href="/tags/juc/" style="font-size: 1.05rem;">juc<sup>1</sup></a><a href="/tags/jwt/" style="font-size: 1.05rem;">jwt<sup>1</sup></a><a href="/tags/log/" style="font-size: 1.05rem;">log<sup>1</sup></a><a href="/tags/maven/" style="font-size: 1.05rem;">maven<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>7</sup></a><a href="/tags/postMan/" style="font-size: 1.05rem;">postMan<sup>1</sup></a><a href="/tags/spring/" style="font-size: 1.05rem;">spring<sup>2</sup></a><a href="/tags/springBoot/" style="font-size: 1.05rem;">springBoot<sup>5</sup></a><a href="/tags/sqlite/" style="font-size: 1.05rem;">sqlite<sup>1</sup></a><a href="/tags/token/" style="font-size: 1.05rem;">token<sup>1</sup></a><a href="/tags/volatile/" style="font-size: 1.05rem;">volatile<sup>1</sup></a><a href="/tags/wireguard/" style="font-size: 1.05rem;">wireguard<sup>1</sup></a><a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 1.05rem;">旅游<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/mysql/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>mysql</span></a></span></div></div><h1 class="post-title" itemprop="name headline">mysql事务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2022-07-26T05:59:55.000Z" title="发表于 2022-07-26 13:59:55">2022-07-26</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-06-14T03:22:55.195Z" title="更新于 2024-06-14 11:22:55">2024-06-14</time></span></div><div class="meta-secondline"></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/images/background/13.jpeg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/"><header><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a><a href="/tags/mysql/" tabindex="-1" itemprop="url">mysql</a><h1 id="CrawlerTitle" itemprop="name headline">mysql事务</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">buer</span><time itemprop="dateCreated datePublished" datetime="2022-07-26T05:59:55.000Z" title="发表于 2022-07-26 13:59:55">2022-07-26</time><time itemprop="dateCreated datePublished" datetime="2024-06-14T03:22:55.195Z" title="更新于 2024-06-14 11:22:55">2024-06-14</time></header><p>MySQL事务and使用方式总结</p>
<span id="more"></span>

<h4 id="一、Mysql-事务的概念"><a href="#一、Mysql-事务的概念" class="headerlink" title="一、Mysql 事务的概念"></a>一、Mysql 事务的概念</h4><p>  Mysql 事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中， 要删除一个人员，既需要删除人员的基本资料，又需要删除和该人员相关的信息，如信箱， 文章等等。这样，这些数据库操作语句就构成一个事务！</p>
<p>事务是一种机制、一个操作序列，包含了一组数据库操作命令，并且把所有的命令作为一个整体一起向系统提交或撤销操作请求，即这一组数据库命令要么都执行，要么都不执行。<br>事务是一个不可分割的工作逻辑单元，在数据库系统上执行并发操作时，事务是最小的控制单元。<br>事务适用于多用户同时操作的数据库系统的场景，如银行、保险公司及证券交易系统等等。<br>事务是通过事务的整体性以保证数据的一致性。<br>  简单来说，所谓事务，它是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。</p>
<h4 id="二、事务的特性（ACID）"><a href="#二、事务的特性（ACID）" class="headerlink" title="二、事务的特性（ACID）"></a>二、事务的特性（ACID）</h4><h5 id="1-原子性"><a href="#1-原子性" class="headerlink" title="1.原子性"></a>1.原子性</h5><h6 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h6><p>每个事务都是单独的不可再分的工作单位，要么整个事务都操作成功，要么全部失败</p>
<h6 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h6><p>  A给B转帐100元钱的时候只执行了扣款语句，就提交了，此时如果突然断电，A账号已经发生了扣款，B账号却没收到加款，在生活中就会引起纠纷。这种情况就需要事务的原子性来保证事务要么都执行，要么就都不执行。</p>
<h5 id="2-一致性"><a href="#2-一致性" class="headerlink" title="2.一致性"></a>2.一致性</h5><h6 id="概念：-1"><a href="#概念：-1" class="headerlink" title="概念："></a>概念：</h6><p>事务在执行前后，数据库的数据完整性没有被破坏，即事务执行前后数据保持一致</p>
<p>即：</p>
<p>事务执行前数据保持一致</p>
<p>事务执行中数据可能不一致</p>
<p>事务执行后数据保持一致</p>
<h6 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h6><p>  对银行转帐事务，不管事务成功还是失败，应该保证事务结束后表中A和B的存款总额跟事务执行前一致。</p>
<h5 id="3-隔离性"><a href="#3-隔离性" class="headerlink" title="3.隔离性"></a>3.隔离性</h5><p>概念：</p>
<p>事务之前互不影响，当不同的事务同时操纵相同的数据时，每个事务都有各自的完整数据空间。</p>
<h5 id="4-持久性"><a href="#4-持久性" class="headerlink" title="4.持久性"></a>4.持久性</h5><h6 id="概念：-2"><a href="#概念：-2" class="headerlink" title="概念："></a>概念：</h6><p>在事务完成以后，该事务所对数据库所作的更改便持久的保存在数据库之中</p>
<h4 id="三、事务之间的相互影响"><a href="#三、事务之间的相互影响" class="headerlink" title="三、事务之间的相互影响"></a>三、事务之间的相互影响</h4><h5 id="1-脏读"><a href="#1-脏读" class="headerlink" title="1.脏读"></a>1.脏读</h5><h6 id="概念：-3"><a href="#概念：-3" class="headerlink" title="概念："></a>概念：</h6><p>脏读是指读到了其他事物未提交的数据，未提交的事物可能会回滚。然后你读到的数据会跟数据库实际数据不一致，产生脏读。</p>
<h6 id="案例：-1"><a href="#案例：-1" class="headerlink" title="案例："></a>案例：</h6><p>比如事务B执行过程中修改了数据X,在未提交前,事务A读取了X,而事务B却回滚了,这样事务A就形成了脏读。 也就是说,当前事务读到的数据是别的事务想要修改成为的但是没有修改成功的数据。</p>
<h5 id="2-不可重复读"><a href="#2-不可重复读" class="headerlink" title="2.不可重复读"></a>2.不可重复读</h5><h6 id="概念：-4"><a href="#概念：-4" class="headerlink" title="概念："></a>概念：</h6><p>一个事物内多次查询出来的数据不一致。原因：查询前后间隔有其他事物提交，更改了数据</p>
<h6 id="案例：-2"><a href="#案例：-2" class="headerlink" title="案例："></a>案例：</h6><p>  事务A第一次查询得到一行记录row1，事务B提交修改后，事务A第二次查询得到row1，但列内容发生了变化。</p>
<h5 id="3-幻读"><a href="#3-幻读" class="headerlink" title="3.幻读"></a>3.幻读</h5><h6 id="概念：-5"><a href="#概念：-5" class="headerlink" title="概念："></a>概念：</h6><p>前后多次读取数据不一致，一个事物对表中的数据修改涉及所有的行。在事物提交前，有另一个事物在表中插入数据，作前一个事务的用户会发现表中还有没有修改的数据行，就好象发生了幻觉一样。</p>
<h6 id="案列："><a href="#案列：" class="headerlink" title="案列："></a>案列：</h6><p>  假设事务A对某些行的内容作了更改，但是还未提交，此时事务B插入了与事务A更改前的记录相同的记录行，并且在事务A提交之前先提交了，而这时，在事务A中查询，会发现好像刚刚的更改对于某些数据未起作用，但其实是事务B刚插入进来的，让用户感觉很魔幻，感觉出现了幻觉，这就叫幻读。</p>
<h5 id="4-丢失更新"><a href="#4-丢失更新" class="headerlink" title="4.丢失更新"></a>4.丢失更新</h5><h6 id="概念：-6"><a href="#概念：-6" class="headerlink" title="概念："></a>概念：</h6><p>两个事务同时读取同一条记录，A 先修改记录，B 也修改记录（B 不知道 A 修改过），B 提交数据后 B 的修改结果覆盖了 A 的修改结果。</p>
<h6 id="案例：-3"><a href="#案例：-3" class="headerlink" title="案例："></a>案例：</h6><p>案列<br>A 30 -&gt;40 事务先完成<br>B 30 -&gt;50 事务后完成<br>B的事务结果会覆盖A的事务结果，最终值为50</p>
<h4 id="四、事务的隔离级别"><a href="#四、事务的隔离级别" class="headerlink" title="四、事务的隔离级别"></a>四、事务的隔离级别</h4><h5 id="1-事物隔离级别分类"><a href="#1-事物隔离级别分类" class="headerlink" title="1.事物隔离级别分类"></a>1.事物隔离级别分类</h5><ul>
<li>&#x3D;&#x3D;read uncommitted&#x3D;&#x3D;（<code>==**未提交读**==</code>）：读取尚未提交的数据 — 会产生脏读</li>
</ul>
<p>​       注：可以读到事务未提交的变更，会产生脏读问题</p>
<ul>
<li><p>&#x3D;&#x3D;read committed&#x3D;&#x3D;（<code>==提交读==</code>）：读取已经提交的数据 — 可以解决脏读</p>
   <!--只能读取到已经提交的数据。Oracle 等多数数据库默认都是该级别。-->
</li>
<li><p>&#x3D;&#x3D;repeatable read&#x3D;&#x3D;（<code>==可重复度==</code>）：重读读取 — 可以解决脏读和不可重复读（mysql 默认）</p>
</li>
</ul>
<p>​       注：可重复读。无论其他事务是否修改并提交了数据，在这个事务中看到的数据值始终不受其他事务影响。</p>
<ul>
<li><p>&#x3D;&#x3D;serializable&#x3D;&#x3D;（<code>串行化</code>）可以解决脏读，不可重复读，幻读-相当于锁表的表锁</p>
<p>注：完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞。</p>
</li>
</ul>
<h5 id="2-事务隔离级别作用范围"><a href="#2-事务隔离级别作用范围" class="headerlink" title="2.事务隔离级别作用范围"></a>2.事务隔离级别作用范围</h5><ul>
<li>全局级：对所有的会话有效</li>
<li>会话级：只对当前的会话有效</li>
</ul>
<h5 id="3-1设置全局隔离级别"><a href="#3-1设置全局隔离级别" class="headerlink" title="3.1设置全局隔离级别"></a>3.1设置全局隔离级别</h5><h5 id="全局"><a href="#全局" class="headerlink" title="全局"></a>全局</h5><h6 id="1-读未提交"><a href="#1-读未提交" class="headerlink" title="1.读未提交"></a>1.读未提交</h6><p>set global transaction isolation level read uncommitted;</p>
<h6 id="2-读提交"><a href="#2-读提交" class="headerlink" title="2.读提交"></a>2.读提交</h6><p>set global transaction isolation level read committed;</p>
<h6 id="3-重复读"><a href="#3-重复读" class="headerlink" title="3.重复读"></a>3.重复读</h6><p>set global transaction isolation level repeatable read;</p>
<h6 id="4-串行化"><a href="#4-串行化" class="headerlink" title="4.串行化"></a>4.串行化</h6><p>set global transaction isolation level serializable;</p>
<h5 id="当前会话"><a href="#当前会话" class="headerlink" title="当前会话"></a>当前会话</h5><p>设置当前会话隔离级别</p>
<p>global   替换为  session</p>
<h5 id="3-2查看当前隔离级别"><a href="#3-2查看当前隔离级别" class="headerlink" title="3.2查看当前隔离级别"></a>3.2查看当前隔离级别</h5><h5 id="当前会话隔离级别"><a href="#当前会话隔离级别" class="headerlink" title="当前会话隔离级别"></a>当前会话隔离级别</h5><p>select @@tx_isolation;<!--8.0之前版本--></p>
<p>select @@transaction_isolation;<!--8.0以后版本--></p>
<h4 id="五、事务控制语句"><a href="#五、事务控制语句" class="headerlink" title="五、事务控制语句"></a>五、事务控制语句</h4><h5 id="事务开启"><a href="#事务开启" class="headerlink" title="事务开启"></a>事务开启</h5><p> <code>BEGIN ｜ START TRANSACTION</code></p>
<p>显式地开启一个事务。</p>
<h5 id="提交事务"><a href="#提交事务" class="headerlink" title="提交事务"></a>提交事务</h5><p><code>COMMIT ｜ COMMIT WORK：</code></p>
<p>提交事务，并使已对数据库进行的所有修改变为永久性的。</p>
<h5 id="回滚事务"><a href="#回滚事务" class="headerlink" title="回滚事务"></a>回滚事务</h5><p><code>ROLLBACK ｜ ROLLBACK WORK</code></p>
<p>回滚会结束用户的事务，并撤销正在进行的所有未提交的修改。</p>
<h5 id="标记回滚点"><a href="#标记回滚点" class="headerlink" title="标记回滚点"></a>标记回滚点</h5><p><code>SAVEPOINT S1</code></p>
<p>使用 SAVEPOINT 允许在事务中创建一个回滚点，一个事务中可以有多个 SAVEPOINT。”S1” 代表回滚点名称。</p>
<h5 id="回滚到回滚点"><a href="#回滚到回滚点" class="headerlink" title="回滚到回滚点"></a>回滚到回滚点</h5><p><code>ROLLBACK TO [SAVEPOINT] S1</code></p>
<p>把事务回滚到标记点。</p>
<h4 id="六、事务操作示例"><a href="#六、事务操作示例" class="headerlink" title="六、事务操作示例"></a>六、事务操作示例</h4><h5 id="1-创建测试数据库"><a href="#1-创建测试数据库" class="headerlink" title="1.创建测试数据库"></a>1.创建测试数据库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE info ( id INT ( 10 ) PRIMARY KEY NOT NULL, NAME VARCHAR ( 40 ), money DOUBLE );</span><br><span class="line"></span><br><span class="line">INSERT INTO info</span><br><span class="line">VALUES</span><br><span class="line">	( 1, &#x27;A&#x27;, 1000 );</span><br><span class="line">INSERT INTO info</span><br><span class="line">VALUES</span><br><span class="line">	( 2, &#x27;B&#x27;, 1000 );</span><br></pre></td></tr></table></figure>

<h5 id="2-测试创建提交事务"><a href="#2-测试创建提交事务" class="headerlink" title="2.测试创建提交事务"></a>2.测试创建提交事务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">begin;</span><br><span class="line">update info set money= money - 100 where name=&#x27;A&#x27;;</span><br><span class="line">select * from info;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>因为是在一个事务里 ，查询到的结果就是update后的结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809152501444.png" alt="image-20220809152501444"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809152841859.png" alt="image-20220809152841859"></p>
<h5 id="3-测试回滚事务"><a href="#3-测试回滚事务" class="headerlink" title="3.测试回滚事务"></a>3.测试回滚事务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BEGIN;</span><br><span class="line">update info set money= money + 100 where name=&#x27;A&#x27;;</span><br><span class="line"> select * from info;</span><br><span class="line">rollback;</span><br><span class="line">select * from info</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>结果1因为是在事务里面，查到了update的数据。	<code>rollback</code>回滚会结束事务，所以结果2查到的是回滚后，操作前原本的数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809153259333.png" alt="image-20220809153259333"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809153823426.png" alt="image-20220809153823426"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809153835281.png" alt="image-20220809153835281"></p>
<h5 id="4-测试多点回滚"><a href="#4-测试多点回滚" class="headerlink" title="4.测试多点回滚"></a>4.测试多点回滚</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BEGIN;</span><br><span class="line">SELECT * from info;</span><br><span class="line">update info set money= money + 100 where name=&#x27;A&#x27;;</span><br><span class="line">select * from info;</span><br><span class="line">savepoint gs1;</span><br><span class="line">update info set money= money + 100 where name=&#x27;B&#x27;;</span><br><span class="line"> select * from info;</span><br><span class="line">savepoint gs2;</span><br><span class="line">insert into info values(3,&#x27;C&#x27;,1000);</span><br><span class="line">select * from info;</span><br><span class="line">rollback to gs1;</span><br><span class="line">select * from info;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809155555306.png" alt="image-20220809155555306"></p>
<p>结果1:原数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809155618386.png" alt="image-20220809155618386"></p>
<p>结果2:数据update name&#x3D;A 加100的结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809155651167.png" alt="image-20220809155651167"></p>
<p>结果3:数据update name&#x3D;B 加100的结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809155716177.png" alt="image-20220809155716177"></p>
<p>结果4:insert语句后的结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809155726646.png" alt="image-20220809155726646"></p>
<p>结果5:回滚到节点gs1的结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2022/07/26/mysql%E4%BA%8B%E5%8A%A1/image-20220809155735490.png" alt="image-20220809155735490"></p>
<h4 id="七、事务提交方式"><a href="#七、事务提交方式" class="headerlink" title="七、事务提交方式"></a>七、事务提交方式</h4><h5 id="查看当前提交方式"><a href="#查看当前提交方式" class="headerlink" title="查看当前提交方式"></a>查看当前提交方式</h5><p>SHOW VARIABLES LIKE ‘AUTOCOMMIT’;</p>
<h5 id="自动提交"><a href="#自动提交" class="headerlink" title="自动提交"></a>自动提交</h5><p>SET AUTOCOMMIT&#x3D;1;</p>
<h5 id="手动提交"><a href="#手动提交" class="headerlink" title="手动提交"></a>手动提交</h5><p>SET AUTOCOMMIT&#x3D;1;</p>
<p>注：如果没有开启自动提交，当前会话连接的 mysql 的所有操作都会当成一个事务直到你输入 rollback|commit；当前事务才算结束。当前事务结束前新的 mysql 连接时无法读取到任何当前会话的操作结果。<br>如果开起了自动提交，mysql 会把每个 sql 语句当成一个事务，然后自动的 commit。<br>当然无论开启与否，begin; commit|rollback; 都是独立的事务。</p>
</article><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/25/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/3.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">mysql数据库索引</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/05/excal%E5%AF%BC%E5%87%BA%E5%AD%97%E4%BD%93%E9%97%AE%E9%A2%98%E5%A4%A7%E5%9D%91/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/14.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">excal导出字体问题大坑</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2022/07/25/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/" title="mysql数据库索引"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/3.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-07-25</div><div class="title">mysql数据库索引</div></div></a></div><div><a href="/2022/07/25/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81/" title="mysql数据库锁"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/4.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-07-25</div><div class="title">mysql数据库锁</div></div></a></div><div><a href="/2022/12/07/mysql%E8%A7%86%E5%9B%BE/" title="mysql视图"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/g1.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-07</div><div class="title">mysql视图</div></div></a></div><div><a href="/2022/10/12/mysql%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E6%8A%A5%E9%94%99/" title="mysql查询分组报错"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/30.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-10-12</div><div class="title">mysql查询分组报错</div></div></a></div><div><a href="/2023/05/14/mysql/" title="mysql"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/30.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-05-14</div><div class="title">mysql</div></div></a></div><div><a href="/2022/05/26/%E5%9F%BA%E4%BA%8EShardingSphere%E7%9A%84%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" title="基于ShardingSphere的分库分表"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/xiaomai19.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-05-26</div><div class="title">基于ShardingSphere的分库分表</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/favicon.ico" alt="status"/></div></div><div class="author-info__description">不如吃茶去</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">buer</h1><div class="author-info__desc">生活明朗，万物可爱</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="http://wpa.qq.com/msgrd?v=3&amp;uin=3198492124&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="anzhiyufont anzhiyu-icon-QQ"></i></a><a class="social-icon faa-parent animated-hover" href="mailto:gs990522_010817@163.com" target="_blank" title="mail"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="social-icon faa-parent animated-hover" href="https://gitee.com/gs990522/" target="_blank" title="gitee"><i class="anzhiyufont anzhiyu-icon-灯泡"></i></a><a class="social-icon faa-parent animated-hover" href="https://github.com/noOldBoy" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81Mysql-%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">一、Mysql 事务的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E6%80%A7%EF%BC%88ACID%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">二、事务的特性（ACID）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text">1.原子性</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A"><span class="toc-number">2.1.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="toc-number">2.1.2.</span> <span class="toc-text">案例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">2.2.</span> <span class="toc-text">2.一致性</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%9A%94%E7%A6%BB%E6%80%A7"><span class="toc-number">2.3.</span> <span class="toc-text">3.隔离性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%8C%81%E4%B9%85%E6%80%A7"><span class="toc-number">2.4.</span> <span class="toc-text">4.持久性</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A-2"><span class="toc-number">2.4.1.</span> <span class="toc-text">概念：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BA%8B%E5%8A%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E7%9B%B8%E4%BA%92%E5%BD%B1%E5%93%8D"><span class="toc-number">3.</span> <span class="toc-text">三、事务之间的相互影响</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%84%8F%E8%AF%BB"><span class="toc-number">3.1.</span> <span class="toc-text">1.脏读</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A-3"><span class="toc-number">3.1.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A-1"><span class="toc-number">3.1.2.</span> <span class="toc-text">案例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">3.2.</span> <span class="toc-text">2.不可重复读</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A-4"><span class="toc-number">3.2.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A-2"><span class="toc-number">3.2.2.</span> <span class="toc-text">案例：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%B9%BB%E8%AF%BB"><span class="toc-number">3.3.</span> <span class="toc-text">3.幻读</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A-5"><span class="toc-number">3.3.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E5%88%97%EF%BC%9A"><span class="toc-number">3.3.2.</span> <span class="toc-text">案列：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%B8%A2%E5%A4%B1%E6%9B%B4%E6%96%B0"><span class="toc-number">3.4.</span> <span class="toc-text">4.丢失更新</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%EF%BC%9A-6"><span class="toc-number">3.4.1.</span> <span class="toc-text">概念：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A-3"><span class="toc-number">3.4.2.</span> <span class="toc-text">案例：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">4.</span> <span class="toc-text">四、事务的隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BA%8B%E7%89%A9%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%88%86%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">1.事物隔离级别分类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4"><span class="toc-number">4.2.</span> <span class="toc-text">2.事务隔离级别作用范围</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">4.3.</span> <span class="toc-text">3.1设置全局隔离级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E5%B1%80"><span class="toc-number">4.4.</span> <span class="toc-text">全局</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E8%AF%BB%E6%9C%AA%E6%8F%90%E4%BA%A4"><span class="toc-number">4.4.1.</span> <span class="toc-text">1.读未提交</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E8%AF%BB%E6%8F%90%E4%BA%A4"><span class="toc-number">4.4.2.</span> <span class="toc-text">2.读提交</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">4.4.3.</span> <span class="toc-text">3.重复读</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">4.4.4.</span> <span class="toc-text">4.串行化</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D"><span class="toc-number">4.5.</span> <span class="toc-text">当前会话</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">4.6.</span> <span class="toc-text">3.2查看当前隔离级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">4.7.</span> <span class="toc-text">当前会话隔离级别</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.</span> <span class="toc-text">五、事务控制语句</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%BC%80%E5%90%AF"><span class="toc-number">5.1.</span> <span class="toc-text">事务开启</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1"><span class="toc-number">5.2.</span> <span class="toc-text">提交事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9E%E6%BB%9A%E4%BA%8B%E5%8A%A1"><span class="toc-number">5.3.</span> <span class="toc-text">回滚事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%87%E8%AE%B0%E5%9B%9E%E6%BB%9A%E7%82%B9"><span class="toc-number">5.4.</span> <span class="toc-text">标记回滚点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9E%E6%BB%9A%E5%88%B0%E5%9B%9E%E6%BB%9A%E7%82%B9"><span class="toc-number">5.5.</span> <span class="toc-text">回滚到回滚点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.</span> <span class="toc-text">六、事务操作示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.1.</span> <span class="toc-text">1.创建测试数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95%E5%88%9B%E5%BB%BA%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.2.</span> <span class="toc-text">2.测试创建提交事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95%E5%9B%9E%E6%BB%9A%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.3.</span> <span class="toc-text">3.测试回滚事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95%E5%A4%9A%E7%82%B9%E5%9B%9E%E6%BB%9A"><span class="toc-number">6.4.</span> <span class="toc-text">4.测试多点回滚</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BA%8B%E5%8A%A1%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">7.</span> <span class="toc-text">七、事务提交方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">7.1.</span> <span class="toc-text">查看当前提交方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4"><span class="toc-number">7.2.</span> <span class="toc-text">自动提交</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%8F%90%E4%BA%A4"><span class="toc-number">7.3.</span> <span class="toc-text">手动提交</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/29/%E8%A5%BF%E5%AE%89%E6%97%85%E6%B8%B8%E8%AE%A1%E5%88%92/" title="西安旅游计划"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/xiaomai19.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="西安旅游计划"/></a><div class="content"><a class="title" href="/2025/01/29/%E8%A5%BF%E5%AE%89%E6%97%85%E6%B8%B8%E8%AE%A1%E5%88%92/" title="西安旅游计划">西安旅游计划</a><time datetime="2025-01-29T13:06:21.000Z" title="发表于 2025-01-29 21:06:21">2025-01-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/19/volatile%E4%BC%AA%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98/" title="volatile伪共享问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/headimg/001.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="volatile伪共享问题"/></a><div class="content"><a class="title" href="/2024/09/19/volatile%E4%BC%AA%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98/" title="volatile伪共享问题">volatile伪共享问题</a><time datetime="2024-09-19T07:39:30.000Z" title="发表于 2024-09-19 15:39:30">2024-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/03/jdk17/" title="jdk17"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/20.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jdk17"/></a><div class="content"><a class="title" href="/2024/09/03/jdk17/" title="jdk17">jdk17</a><time datetime="2024-09-03T08:52:54.000Z" title="发表于 2024-09-03 16:52:54">2024-09-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/27/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E7%BC%96%E6%8E%92/" title="异步任务编排"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/li.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="异步任务编排"/></a><div class="content"><a class="title" href="/2024/07/27/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E7%BC%96%E6%8E%92/" title="异步任务编排">异步任务编排</a><time datetime="2024-07-26T22:02:52.000Z" title="发表于 2024-07-27 06:02:52">2024-07-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/14/mysql/" title="mysql"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/background/30.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mysql"/></a><div class="content"><a class="title" href="/2023/05/14/mysql/" title="mysql">mysql</a><time datetime="2023-05-14T07:36:58.000Z" title="发表于 2023-05-14 15:36:58">2023-05-14</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2021 - 2025 By <a class="footer-bar-link" href="/" title="buer" target="_blank">buer</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://nooldboy.github.io/" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">30</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://nooldboy.github.io/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 应用箱</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://165.154.134.66:8000"><i class="anzhiyufont anzhiyu-icon-stopwatch faa-tada" style="font-size: 0.9em;"></i><span> 项目平台</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://165.154.134.66:8123"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 智能家居</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://165.154.134.66:3000"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> AI</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BigDecimal/" style="font-size: 0.88rem;">BigDecimal<sup>1</sup></a><a href="/tags/Cookie/" style="font-size: 0.88rem;">Cookie<sup>1</sup></a><a href="/tags/English/" style="font-size: 0.88rem;">English<sup>1</sup></a><a href="/tags/Mac/" style="font-size: 0.88rem;">Mac<sup>2</sup></a><a href="/tags/Session/" style="font-size: 0.88rem;">Session<sup>1</sup></a><a href="/tags/Transactional/" style="font-size: 0.88rem;">Transactional<sup>1</sup></a><a href="/tags/Typora/" style="font-size: 0.88rem;">Typora<sup>1</sup></a><a href="/tags/aop/" style="font-size: 0.88rem;">aop<sup>1</sup></a><a href="/tags/bug/" style="font-size: 0.88rem;">bug<sup>5</sup></a><a href="/tags/cron/" style="font-size: 0.88rem;">cron<sup>1</sup></a><a href="/tags/css/" style="font-size: 0.88rem;">css<sup>1</sup></a><a href="/tags/excal/" style="font-size: 0.88rem;">excal<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>2</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>11</sup></a><a href="/tags/js/" style="font-size: 0.88rem;">js<sup>1</sup></a><a href="/tags/jsoup/" style="font-size: 0.88rem;">jsoup<sup>1</sup></a><a href="/tags/juc/" style="font-size: 0.88rem;">juc<sup>1</sup></a><a href="/tags/jwt/" style="font-size: 0.88rem;">jwt<sup>1</sup></a><a href="/tags/log/" style="font-size: 0.88rem;">log<sup>1</sup></a><a href="/tags/maven/" style="font-size: 0.88rem;">maven<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>7</sup></a><a href="/tags/postMan/" style="font-size: 0.88rem;">postMan<sup>1</sup></a><a href="/tags/spring/" style="font-size: 0.88rem;">spring<sup>2</sup></a><a href="/tags/springBoot/" style="font-size: 0.88rem;">springBoot<sup>5</sup></a><a href="/tags/sqlite/" style="font-size: 0.88rem;">sqlite<sup>1</sup></a><a href="/tags/token/" style="font-size: 0.88rem;">token<sup>1</sup></a><a href="/tags/volatile/" style="font-size: 0.88rem;">volatile<sup>1</sup></a><a href="/tags/wireguard/" style="font-size: 0.88rem;">wireguard<sup>1</sup></a><a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 0.88rem;">旅游<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2021 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 buer 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'yQqxFEGEHmdPMQcBX'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>